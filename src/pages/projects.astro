---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

const projects = await getCollection("projects");
const sortedProjects = projects.sort((a, b) => b.data.year - a.data.year);

// Import all project images
const images: Record<string, { default: ImageMetadata }> =
	await import.meta.glob("/src/assets/projects/*.{jpg,png}", {
		eager: true,
	});

// Find the image for a project
function getProjectImage(project: any) {
	return project.data.image
		? Object.entries(images).find(([path]) =>
				path.includes(project.data.image),
			)?.[1]?.default
		: null;
}
---

<Layout>
	<main class="max-w-4xl mx-auto px-6 py-16">
		<div class="space-y-4">
			{
				sortedProjects.map((project) => {
					const projectImage = getProjectImage(project);
					return (
						<div class="flex items-start gap-6 p-6 border-b border-gray-100 pb-6">
							{projectImage && (
								<div class="w-32 h-24 flex-shrink-0 rounded-lg overflow-hidden">
									<Image
										src={projectImage}
										alt={`Screenshot of ${project.data.name}`}
										class="w-full h-full object-cover"
										loading="lazy"
									/>
								</div>
							)}
							<div class="flex-grow">
								<div class="flex justify-between items-baseline mb-2">
									<h3 class="text-xl font-medium font-serif">
										{project.data.name}
									</h3>
									<span class="text-base text-gray-500">
										{project.data.year}
									</span>
								</div>
								<p class="text-base text-gray-700 mb-3 font-sans">
									{project.data.description}
								</p>
								<div class="flex gap-4 text-sm">
									{project.data.source_code && (
										<a
											href={project.data.source_code}
											class="text-blue-600 hover:text-blue-800 font-medium"
											target="_blank"
											rel="noopener"
										>
											Source
										</a>
									)}
									{project.data.project_url &&
										!project.data.tags.includes(
											"offline",
										) && (
											<a
												href={
													project.data.project_url.startsWith(
														"http",
													)
														? project.data
																.project_url
														: `https://${project.data.project_url}`
												}
												class="text-blue-600 hover:text-blue-800 font-medium"
												target="_blank"
												rel="noopener"
											>
												Website
											</a>
										)}
								</div>
							</div>
						</div>
					);
				})
			}
		</div>
	</main>
</Layout>
